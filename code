local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- =====================================================
--  üéØ Helper: Find Target Player
-- =====================================================
local function getTarget(name)
	if not name or name == "" then return nil end
	local target

	if name == "rand" then
		local all = Players:GetPlayers()
		if #all > 1 then
			repeat
				target = all[math.random(1, #all)]
			until target ~= player
		end
	else
		for _, plr in pairs(Players:GetPlayers()) do
			if plr.Name:lower():sub(1, #name) == name then
				target = plr
				break
			end
		end
	end

	return target
end

-- =====================================================
--  ‚öîÔ∏è Kill Command
-- =====================================================
local function killTarget(target)
	local char = player.Character
	if not target or not char or not char:FindFirstChild("HumanoidRootPart") then
		warn("Target or player character not found.")
		return
	end

	local hrp = char.HumanoidRootPart
	local originalCFrame = hrp.CFrame -- Save position to return

	local stroller = player.Backpack:FindFirstChild("Stroller") or char:FindFirstChild("Stroller")
	if not stroller then
		warn("No stroller found!")
		return
	end

	-- Equip stroller
	stroller.Parent = char
	task.wait(1)

	if target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
		local targetHRP = target.Character.HumanoidRootPart

		-- Force stand up if sitting
		local hum = target.Character:FindFirstChildOfClass("Humanoid")
		if hum and hum.Sit then
			local seat = hum.SeatPart
			if seat then
				seat:Sit(nil)
			end
			hum.Sit = false
			task.wait(0.25)
		end

		-- Move in front of target
		hrp.CFrame = CFrame.new(targetHRP.Position - Vector3.new(0, 2, -4))
		task.wait(1)

		-- ‚úÖ Check if stroller actually picked up the target
		local grabbed = false
		for _, desc in pairs(char:GetDescendants()) do
			if desc:IsA("Weld") and desc.Part1 and desc.Part1:IsDescendantOf(target.Character) then
				grabbed = true
				break
			end
		end

		if not grabbed then
			warn("Stroller didn‚Äôt grab the target. Cancelling teleport.")
			stroller.Parent = player.Backpack
			return
		end

		-- Anchor briefly to stabilize physics
		hrp.Anchored = true
		task.wait(0.2)
		hrp.Anchored = false

		-- Teleport far away (void fling)
		local randomPos = CFrame.new(math.random(-1e4, 1e4), 150, math.random(-1e4, 1e4))
		hrp.CFrame = randomPos
		task.wait(0.35)

		-- Unequip stroller to drop target
		stroller.Parent = player.Backpack
		task.wait(0.4)

		-- Try swapping another tool to force drop
		local otherTool
		for _, tool in pairs(player.Backpack:GetChildren()) do
			if tool:IsA("Tool") and tool.Name ~= "Stroller" then
				otherTool = tool
				break
			end
		end

		if otherTool then
			otherTool.Parent = char
			task.wait(0.5)
			otherTool.Parent = player.Backpack
		end

		-- Wait for drop to finish replicating
		task.wait(1.2)

		-- ‚úÖ Teleport back to original position
		hrp.CFrame = originalCFrame
	end
end

-- =====================================================
--  üåÄ TP Command
-- =====================================================
local function tpTarget(target)
	local char = player.Character
	if not target or not char or not char:FindFirstChild("HumanoidRootPart") then
		warn("Target or player character not found.")
		return
	end

	local hrp = char.HumanoidRootPart
	local targetHRP = target.Character and target.Character:FindFirstChild("HumanoidRootPart")
	if not targetHRP then
		warn("Target has no HumanoidRootPart!")
		return
	end

	-- Teleport in front of target
	hrp.CFrame = CFrame.new(targetHRP.Position - Vector3.new(0, 2, -4))
end

-- =====================================================
--  üí¨ Chat Commands
-- =====================================================
player.Chatted:Connect(function(msg)
	msg = msg:lower()

	if msg:sub(1,5) == "-kill" then
		local targetName = msg:sub(7)
		local target = getTarget(targetName)
		killTarget(target)
	elseif msg:sub(1,3) == "-tp" then
		local targetName = msg:sub(5)
		local target = getTarget(targetName)
		tpTarget(target)
	end
end)
